---
kind: pipeline
type: docker
name: demo

platform:
  arch: amd64
  os: linux

steps:
  - name: test
    image: alpine
    commands:
      - echo test

  - name: build
    image: alpine
    commands:
      - echo build

  - name: publish
    image: alpine
    commands:
      - echo publish

trigger:
  event:
    - push
    - tag
---
kind: pipeline
type: docker
name: aspnet

platform:
  arch: amd64
  os: linux

steps:
  - name: test
    image: mcr.microsoft.com/dotnet/sdk:6.0
    commands:
      - cd aspnet
      - dotnet build
      - dotnet test

  - name: publish
    image: plugins/docker
    environment:
      PLUGIN_REGISTRY: registry.nbaxp.com/repository/docker/
      PLUGIN_REPO: https://registry.nbaxp.com/repository/docker/demo/aspnet
    settings:
      dockerfile: aspnet/Dockerfile
      username: admin
      password: wanggang123!
      tags:
        - latest
        - ${DRONE_STAGE_OS}-${DRONE_STAGE_ARCH}-${DRONE_REPO_BRANCH}-${DRONE_COMMIT_SHA:0:8}

trigger:
  event:
    - push
    - tag
